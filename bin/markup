#!/usr/bin/env ruby

require 'erb'
require 'pygments.rb'
require 'redcarpet'

class AlbinoHTML < Redcarpet::Render::HTML
  include Redcarpet::Render::SmartyPants

  def block_code(code, language)
    Pygments.highlight code,
      :lexer   => language || 'text',
      :options => { :encoding => 'utf-8' }
  end
end

markdown = Redcarpet::Markdown.new AlbinoHTML,
  :autolink            => true,
  :fenced_code_blocks  => true,
  :hard_wrap           => true,
  :lax_html_blocks     => true,
  :no_intra_emphasis   => true,
  :space_after_headers => true,
  :strikethrough       => true,
  :superscripts        => true,
  :tables              => true

html  = markdown.render File.read(ARGV[0])
title = ARGV[1] || File.basename(ARGV[0], File.extname(ARGV[0]))

puts ERB.new(DATA.read).result

__END__
<!doctype html>
<html lang=en>
  <head>
    <meta charset=utf-8>
    <title><%= title %></title>
    <style>
      /* normalize.css 2011-09-14T10:27 UTC - http://github.com/necolas/normalize.css */
      article,
      aside,
      details,
      figcaption,
      figure,
      footer,
      header,
      hgroup,
      nav,
      section {
        display: block
      }
      audio,
      canvas,
      video {
        display: inline-block;*display:inline;*zoom:1
      }
      audio:not([controls]) {
        display: none
      }
      [hidden] {
        display: none
      }
      html {
        font-size: 100%;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%
      }
      body {
        margin: 0
      }
      body,
      button,
      input,
      select,
      textarea {
        font-family: "Alegreya", Palatino, Georgia, serif
      }
      a {
        color: #00e
      }
      a:visited {
        color: #551a8b
      }
      a:focus {
        outline: thin dotted
      }
      a:hover,
      a:active {
        outline: 0
      }
      abbr[title] {
        border-bottom: 1px dotted
      }
      b,
      strong {
        font-weight: bold
      }
      blockquote {
        margin: 1em 40px
      }
      dfn {
        font-style: italic
      }
      mark {
        background: #ff0;color:#000
      }
      pre,
      code,
      kbd,
      samp {
        font-family: monospace, serif;_font-family:'courier new', monospace;font-size:1em
      }
      pre {
        white-space: pre;white-space:pre-wrap;word-wrap:break-word
      }
      q {
        quotes: none
      }
      q:before,
      q:after {
        content: '';content:none
      }
      small {
        font-size: 75%
      }
      sub,
      sup {
        font-size: 75%;line-height:0;position:relative;vertical-align:baseline
      }
      sup {
        top: -0.5em
      }
      sub {
        bottom: -0.25em
      }
      ul,
      ol {
        margin: 1em 0;padding:0 0 0 40px
      }
      dd {
        margin: 0 0 0 40px
      }
      nav ul,
      nav ol {
        list-style: none;list-style-image:none
      }
      img {
        border: 0;-ms-interpolation-mode:bicubic
      }
      svg:not(:root) {
        overflow: hidden
      }
      figure {
        margin: 0
      }
      form {
        margin: 0
      }
      fieldset {
        border: 1px solid #c0c0c0;margin:0 2px;padding:0.35em 0.625em 0.75em
      }
      legend {
        border: 0;*margin-left:-7px
      }
      button,
      input,
      select,
      textarea {
        font-size: 100%;margin:0;vertical-align:baseline;*vertical-align:middle
      }
      button,
      input {
        line-height: normal;*overflow:visible
      }
      table button,
      table input {
        *overflow: auto
      }
      button,
      input[type="button"],
      input[type="reset"],
      input[type="submit"] {
        cursor: pointer;-webkit-appearance:button
      }
      input[type="checkbox"],
      input[type="radio"] {
        box-sizing: border-box;padding:0
      }
      input[type="search"] {
        -webkit-appearance: textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box
      }
      input[type="search"]::-webkit-search-decoration {
        -webkit-appearance: none
      }
      button::-moz-focus-inner,
      input::-moz-focus-inner {
        border: 0;padding:0
      }
      textarea {
        overflow: auto;vertical-align:top
      }
      table {
        border-collapse: collapse;border-spacing:0
      }
      * {
        -moz-box-sizing: border-box;-webkit-box-sizing:border-box;box-sizing:border-box
      }
      html {
        background-color: #fff;padding:0;margin:0;width:100%
      }
      body {
        width: 100%;height:100%;padding:1em;margin:0;font-family: Palatino, Georgia, serif;color:#444
      }
      a {
        color: #fc263a;-webkit-transition:all 0.25s;-moz-transition:all 0.25s;-o-transition:all 0.25s;transition:all 0.25s
      }
      a:hover,
      a:visited:hover {
        color: #b90314
      }
      a:visited {
        color: #fd717f
      }
      .content {
        padding: 0.809em;max-width:30em;margin:auto
      }
      article h1,
      article h2,
      article h3,
      article h4,
      article h5 {
        font-weight: normal;margin-top:2em;color:black
      }
      article h1,
      article h2 {
        font-size: 1.5em
      }
      article h3 {
        font-family: "Alegreya SC", Palatino, Georgia, serif;font-weight:normal;text-transform:lowercase
      }
      article h4 {
        font-size: 1em;font-style:italic
      }
      article h5 {
        font-style: normal
      }
      article ul,
      article ol {
        list-style-position: outside;padding:0
      }
      article blockquote {
        margin: 0;padding-left:1em;border-left:1px solid #aaa
      }
      article img,
      article object,
      article video,
      article audio,
      article figure,
      article iframe {
        max-width: 100%
      }
      @media all and (min-width: 33.236em) {
        .content {
          padding: 1.618em;
          margin: 0 auto;
          max-width: 56rem;
          font-size: 1.25em;
        }
      }
      @media all and (min-width: 33.236em) and screen and (min-width: 30em) and (max-width: 63.236em) {
        .content {
          width: 30em
        }
      }
      @-webkit-keyframes throb {
        0% {
          opacity: 0.25
        }
        100% {
          opacity: 1
        }
      }
      @-moz-keyframes throb {
        0% {
          opacity: 0.25
        }
        100% {
          opacity: 1
        }
      }
      @-ms-keyframes throb {
        0% {
          opacity: 0.25
        }
        100% {
          opacity: 1
        }
      }
      @-o-keyframes throb {
        0% {
          opacity: 0.25
        }
        100% {
          opacity: 1
        }
      }
    </style>
  </head>
  <body>

  <article class=content>
    <%= html %>
  </article>

  </body>
</html>
